{block content}

{* P≈ôid√°n√≠ konzistentn√≠ch styl≈Ø s cel√Ωm webem *}
{block head}
<style>
    /* Konzistentn√≠ fonty podle cel√©ho webu */
    .page-title {
        font-family: 'Inter', sans-serif;
        font-weight: 700;
        font-size: 28px;
        color: #212529;
        margin-bottom: 8px;
    }
    
    .page-subtitle {
        font-family: 'Inter', sans-serif;
        font-weight: 400;
        font-size: 16px;
        color: #6c757d;
        margin-bottom: 0;
    }
    
    .main-card {
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    
    .card-header-custom {
        background: #f8f9fa;
        border-bottom: 1px solid #e0e0e0;
        padding: 1rem 1.5rem;
        border-radius: 8px 8px 0 0;
    }
    
    .card-title-custom {
        font-family: 'Inter', sans-serif;
        font-weight: 600;
        font-size: 18px;
        color: #212529;
        margin-bottom: 0;
    }
    
    .form-section {
        margin-bottom: 2rem;
        position: relative;
    }
    
    .form-section-title {
        font-family: 'Inter', sans-serif;
        font-weight: 600;
        font-size: 16px;
        color: #212529;
        margin-bottom: 1rem;
        padding-bottom: 8px;
        border-bottom: 2px solid;
        display: flex;
        align-items: center;
    }
    
    .form-section-title.section-tenant {
        border-bottom-color: #B1D235;
    }
    
    .form-section-title.section-company {
        border-bottom-color: #95B11F;
    }
    
    .form-section-title.section-admin {
        border-bottom-color: #6c757d;
    }
    
    .form-label-custom {
        font-family: 'Inter', sans-serif;
        font-weight: 500;
        font-size: 14px;
        color: #212529;
        margin-bottom: 4px;
    }
    
    .form-control-custom {
        font-family: 'Inter', sans-serif;
        font-weight: 400;
        font-size: 14px;
        border: 1px solid #e0e0e0;
        border-radius: 6px;
        padding: 8px 12px;
        transition: all 0.2s ease;
    }
    
    .form-control-custom:focus {
        border-color: #B1D235;
        outline: 0;
        box-shadow: 0 0 0 0.2rem rgba(177, 210, 53, 0.25);
    }
    
    .form-text-custom {
        font-family: 'Inter', sans-serif;
        font-weight: 400;
        font-size: 12px;
        color: #6c757d;
        margin-top: 4px;
    }
    
    .form-check-custom {
        display: flex;
        align-items: center;
        padding: 12px 0;
    }
    
    .form-check-input-custom {
        width: 18px;
        height: 18px;
        margin-right: 12px;
        border: 2px solid #e0e0e0;
        border-radius: 4px;
        transition: all 0.2s ease;
        cursor: pointer;
    }
    
    .form-check-input-custom:checked {
        background-color: #B1D235;
        border-color: #B1D235;
    }
    
    .form-check-label-custom {
        font-family: 'Inter', sans-serif;
        font-weight: 500;
        font-size: 14px;
        color: #212529;
        cursor: pointer;
        margin-bottom: 0;
    }
    
    .alert-custom {
        background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        border: 1px solid #95B11F;
        border-radius: 6px;
        padding: 12px 16px;
    }
    
    .alert-custom-text {
        font-family: 'Inter', sans-serif;
        font-weight: 400;
        font-size: 14px;
        color: #212529;
        margin-bottom: 0;
        display: flex;
        align-items: center;
    }
    
    .btn-primary-custom {
        background: linear-gradient(135deg, #B1D235 0%, #95B11F 100%);
        border: none;
        color: #212529;
        font-family: 'Inter', sans-serif;
        font-weight: 600;
        font-size: 14px;
        padding: 10px 20px;
        border-radius: 6px;
        transition: all 0.2s ease;
    }
    
    .btn-primary-custom:hover {
        background: linear-gradient(135deg, #95B11F 0%, #7a9b1a 100%);
        color: #212529;
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(177, 210, 53, 0.3);
    }
    
    .btn-secondary-custom {
        background: #6c757d;
        border: none;
        color: white;
        font-family: 'Inter', sans-serif;
        font-weight: 600;
        font-size: 14px;
        padding: 10px 20px;
        border-radius: 6px;
        transition: all 0.2s ease;
    }
    
    .btn-secondary-custom:hover {
        background: #5a6268;
        color: white;
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(108, 117, 125, 0.3);
    }
    
    .help-card {
        background: white;
        border: 1px solid #e0e0e0;
        border-radius: 8px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    }
    
    .help-title {
        font-family: 'Inter', sans-serif;
        font-weight: 600;
        font-size: 16px;
        color: #212529;
        margin-bottom: 16px;
        display: flex;
        align-items: center;
    }
    
    .help-subtitle {
        font-family: 'Inter', sans-serif;
        font-weight: 500;
        font-size: 14px;
        margin-bottom: 8px;
    }
    
    .help-text {
        font-family: 'Inter', sans-serif;
        font-weight: 400;
        font-size: 13px;
        color: #6c757d;
        margin-bottom: 4px;
    }
    
    .help-alert {
        background: linear-gradient(135deg, #fff3cd 0%, #fdf6d8 100%);
        border: 1px solid #B1D235;
        border-radius: 6px;
        padding: 12px;
    }
    
    .help-alert-text {
        font-family: 'Inter', sans-serif;
        font-weight: 400;
        font-size: 13px;
        color: #212529;
        margin-bottom: 0;
        display: flex;
        align-items: flex-start;
    }
    
    @media (max-width: 768px) {
        .btn-group-mobile {
            flex-direction: column !important;
            gap: 8px !important;
        }
        
        .btn-group-mobile .btn {
            width: 100%;
        }
        
        .page-title {
            font-size: 24px;
        }
    }
    
    /* Animace pro DIƒå pole */
    #dic-row {
        transition: all 0.3s ease;
        overflow: hidden;
    }
    
    #dic-row.fade-in {
        opacity: 1;
        max-height: 200px;
    }
    
    #dic-row.fade-out {
        opacity: 0;
        max-height: 0;
        margin: 0;
        padding: 0;
    }
</style>
{/block}

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="page-title">
            <i class="bi bi-building-add me-2" style="color: #B1D235;"></i>
            Vytvo≈ôit nov√Ω tenant
        </h1>
        <p class="page-subtitle">
            <i class="bi bi-info-circle me-1" style="color: #95B11F;"></i>
            Vytvo≈ôen√≠ nov√©ho tenanta s administr√°torem a z√°kladn√≠m nastaven√≠m
        </p>
    </div>
    <div>
        <a n:href="default" class="btn btn-secondary-custom">
            <i class="bi bi-arrow-left me-2"></i>
            Zpƒõt na seznam
        </a>
    </div>
</div>

<div class="row">
    <div class="col-xl-8 col-lg-10">
        <div class="main-card">
            <div class="card-header-custom">
                <h5 class="card-title-custom">
                    <i class="bi bi-building me-2" style="color: #B1D235;"></i>
                    √ödaje nov√©ho tenanta
                </h5>
            </div>
            <div class="p-4">
                {form createTenantForm}
                    {* Z√°kladn√≠ √∫daje tenanta *}
                    <div class="form-section">
                        <h6 class="form-section-title section-tenant">
                            <i class="bi bi-building me-2" style="color: #B1D235;"></i>
                            Z√°kladn√≠ √∫daje tenanta
                        </h6>
                        
                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label class="form-label-custom">N√°zev tenanta</label>
                                {input name class => 'form-control form-control-custom'}
                                <div class="form-text-custom">
                                    <i class="bi bi-info-circle me-1" style="color: #95B11F;"></i>
                                    N√°zev bude pou≈æit pro identifikaci tenanta v syst√©mu
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label class="form-label-custom">Dom√©na (voliteln√©)</label>
                                {input domain class => 'form-control form-control-custom'}
                                <div class="form-text-custom">
                                    <i class="bi bi-globe me-1" style="color: #95B11F;"></i>
                                    nap≈ô. firma-abc.cz
                                </div>
                            </div>
                        </div>
                    </div>

                    {* √ödaje spoleƒçnosti *}
                    <div class="form-section">
                        <h6 class="form-section-title section-company">
                            <i class="bi bi-briefcase me-2" style="color: #95B11F;"></i>
                            √ödaje spoleƒçnosti
                        </h6>
                        
                        {* IƒåO s ARES tlaƒç√≠tkem na zaƒç√°tku *}
                        <div class="row">
                            <div class="col-md-8 mb-3">
                                <label class="form-label-custom">IƒåO</label>
                                <div class="input-group">
                                    {input ic class => 'form-control form-control-custom'}
                                    <button type="button" id="load-from-ares" class="btn btn-primary-custom">
                                        <i class="bi bi-cloud-download"></i> Naƒç√≠st z ARESu
                                    </button>
                                </div>
                                <div class="form-text-custom">
                                    <i class="bi bi-info-circle me-1" style="color: #95B11F;"></i>
                                    Zadejte IƒåO a naƒçtƒõte √∫daje spoleƒçnosti automaticky z ARESu
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="form-check-custom" style="padding-top: 32px;">
                                    {input vat_payer class => 'form-check-input form-check-input-custom'}
                                    {label vat_payer class => 'form-check-label-custom' /}
                                </div>
                            </div>
                        </div>
                        
                        {* DIƒå pole - zobraz√≠ se pod IƒåO kdy≈æ je checkbox za≈°krtnut√Ω *}
                        <div class="row" id="dic-row" style="display: none;">
                            <div class="col-md-6 mb-3">
                                <label class="form-label-custom">DIƒå</label>
                                {input dic class => 'form-control form-control-custom'}
                                <div class="form-text-custom">nap≈ô. CZ12345678</div>
                            </div>
                        </div>
                        
                        {* N√°zev spoleƒçnosti - vypln√≠ se z ARESu *}
                        <div class="row">
                            <div class="col-12 mb-3">
                                <label class="form-label-custom">N√°zev spoleƒçnosti</label>
                                {input company_name class => 'form-control form-control-custom'}
                                <div class="form-text-custom">
                                    <i class="bi bi-magic me-1" style="color: #95B11F;"></i>
                                    Vypln√≠ se automaticky po naƒçten√≠ z ARESu
                                </div>
                            </div>
                        </div>
                        
                        {* Dal≈°√≠ pole - telefon atd. *}
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label-custom">Telefon</label>
                                {input phone class => 'form-control form-control-custom'}
                                <div class="form-text-custom">nap≈ô. +420 123 456 789</div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label-custom">Adresa</label>
                                {input address class => 'form-control form-control-custom', rows => 2}
                                <div class="form-text-custom">Ulice a ƒç√≠slo popisn√©</div>
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label-custom">Mƒõsto</label>
                                {input city class => 'form-control form-control-custom'}
                            </div>
                            <div class="col-md-3 mb-3">
                                <label class="form-label-custom">PSƒå</label>
                                {input zip class => 'form-control form-control-custom'}
                                <div class="form-text-custom">123 45</div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label-custom">Zemƒõ</label>
                                {input country class => 'form-control form-control-custom'}
                            </div>
                        </div>
                    </div>

                    {* Administr√°tor tenanta *}
                    <div class="form-section">
                        <h6 class="form-section-title section-admin">
                            <i class="bi bi-person-gear me-2" style="color: #6c757d;"></i>
                            Administr√°tor tenanta
                        </h6>
                        
                        <div class="alert-custom mb-3">
                            <div class="alert-custom-text">
                                <i class="bi bi-info-circle me-2" style="color: #95B11F;"></i>
                                <strong>D≈Øle≈æit√©:</strong> Tento u≈æivatel bude m√≠t pln√° administr√°torsk√° pr√°va v r√°mci vytvo≈ôen√©ho tenanta.
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label-custom">U≈æivatelsk√© jm√©no</label>
                                {input username class => 'form-control form-control-custom'}
                                <div class="form-text-custom">Jedineƒçn√© u≈æivatelsk√© jm√©no pro p≈ôihl√°≈°en√≠</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label-custom">E-mail</label>
                                {input email class => 'form-control form-control-custom'}
                                <div class="form-text-custom">E-mailov√° adresa administr√°tora</div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label-custom">Heslo</label>
                                {input password class => 'form-control form-control-custom'}
                                <div class="form-text-custom">Minim√°lnƒõ 6 znak≈Ø</div>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label-custom">Ovƒõ≈ôen√≠ hesla</label>
                                {input password_confirm class => 'form-control form-control-custom'}
                                <div class="form-text-custom">Zadejte heslo znovu pro ovƒõ≈ôen√≠</div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label class="form-label-custom">Jm√©no</label>
                                {input first_name class => 'form-control form-control-custom'}
                            </div>
                            <div class="col-md-6 mb-3">
                                <label class="form-label-custom">P≈ô√≠jmen√≠</label>
                                {input last_name class => 'form-control form-control-custom'}
                            </div>
                        </div>
                    </div>

                    {* Tlaƒç√≠tka *}
                    <div class="d-flex justify-content-between align-items-center pt-4" style="border-top: 1px solid #e0e0e0;">
                        <div class="form-text-custom">
                            <i class="bi bi-info-circle me-1"></i>
                            Po vytvo≈ôen√≠ bude tenant ihned aktivn√≠ a administr√°tor se bude moci p≈ôihl√°sit.
                        </div>
                        <div class="d-flex gap-2 btn-group-mobile">
                            {input cancel class => 'btn btn-secondary-custom'}
                            {input send class => 'btn btn-primary-custom'}
                        </div>
                    </div>
                {/form}
            </div>
        </div>
    </div>
    
    {* Postrann√≠ panel s n√°povƒõdou *}
    <div class="col-xl-4 col-lg-2">
        <div class="sticky-top" style="top: 2rem;">
            <div class="help-card">
                <div class="p-3">
                    <h6 class="help-title">
                        <i class="bi bi-lightbulb me-2" style="color: #B1D235;"></i>
                        N√°povƒõda
                    </h6>
                    
                    <div class="mb-3">
                        <h6 class="help-subtitle" style="color: #95B11F;">Co se vytvo≈ô√≠?</h6>
                        <ul class="list-unstyled">
                            <li class="help-text">‚Ä¢ Nov√Ω tenant v syst√©mu</li>
                            <li class="help-text">‚Ä¢ Admin u≈æivatel s pln√Ωmi pr√°vy</li>
                            <li class="help-text">‚Ä¢ Z√°kladn√≠ firemn√≠ √∫daje</li>
                            <li class="help-text">‚Ä¢ Adres√°≈ôov√° struktura pro moduly</li>
                            <li class="help-text">‚Ä¢ Zkop√≠rov√°n√≠ z√°kladn√≠ch modul≈Ø</li>
                        </ul>
                    </div>
                    
                    <div class="mb-3">
                        <h6 class="help-subtitle" style="color: #95B11F;">Jak vyplnit formul√°≈ô?</h6>
                        <ul class="list-unstyled">
                            <li class="help-text">‚Ä¢ N√°zev tenanta mus√≠ b√Ωt unik√°tn√≠</li>
                            <li class="help-text">‚Ä¢ IƒåO je povinn√© pro firemn√≠ √∫daje</li>
                            <li class="help-text">‚Ä¢ DIƒå se zobraz√≠ po za≈°krtnut√≠ "Pl√°tce DPH"</li>
                            <li class="help-text">‚Ä¢ Username pro admin mus√≠ b√Ωt unik√°tn√≠</li>
                        </ul>
                    </div>
                    
                    <div class="mb-3">
                        <h6 class="help-subtitle" style="color: #95B11F;">Bezpeƒçnost</h6>
                        <ul class="list-unstyled">
                            <li class="help-text">‚Ä¢ Ka≈æd√Ω tenant m√° izolovan√° data</li>
                            <li class="help-text">‚Ä¢ Admin vid√≠ pouze sv≈Øj tenant</li>
                            <li class="help-text">‚Ä¢ Automatick√© logov√°n√≠ zmƒõn</li>
                        </ul>
                    </div>
                    
                    <div class="help-alert">
                        <div class="help-alert-text">
                            <i class="bi bi-exclamation-triangle me-1"></i>
                            <strong>Tip:</strong> Zkontrolujte v≈°echny √∫daje p≈ôed vytvo≈ôen√≠m. Nƒõkter√© √∫daje se pozdƒõji obt√≠≈ænƒõ mƒõn√≠.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{syntax off}
<script>
// JavaScript pro DIƒå toggle v tenant formul√°≈ôi
document.addEventListener('DOMContentLoaded', function() {
    // ZABR√ÅNƒöN√ç KONFLIKTU s ares-lookup.js
    // Oznaƒç√≠me, ≈æe tenant formul√°≈ô m√° vlastn√≠ ARES handling
    window.tenantFormActive = true;
    
    // Poƒçkej chvilku, ne≈æ se spust√≠ settings.js a pak p≈ôeber kontrolu
    setTimeout(function() {
        console.log('üöÄ Tenant form - p≈ôevz√≠m√°m kontrolu nad DIƒå toggle');
        
        // Najdi checkbox podle skuteƒçn√©ho Nette Forms ID
        var checkbox = document.querySelector('input[name="vat_payer"]') || 
                      document.getElementById('frm-createTenantForm-vat_payer');
        var dicRow = document.getElementById('dic-row');
        
        console.log('Checkbox nalezen:', !!checkbox);
        console.log('DIƒå ≈ô√°dek nalezen:', !!dicRow);
        
        if (checkbox && dicRow) {
            console.log('‚úÖ Nastavujem event listener pro checkbox');
            
            // Odstranit p≈ô√≠padn√© existuj√≠c√≠ listenery
            checkbox.removeEventListener('change', arguments.callee);
            
            checkbox.addEventListener('change', function() {
                console.log('üîÑ Checkbox zmƒõnƒõn, checked:', this.checked);
                
                if (this.checked) {
                    dicRow.style.display = 'block';
                    var dicInput = dicRow.querySelector('input[name="dic"]');
                    if (dicInput) {
                        dicInput.required = true;
                        setTimeout(function() { dicInput.focus(); }, 100);
                    }
                    console.log('‚úÖ DIƒå pole zobrazeno');
                } else {
                    dicRow.style.display = 'none';
                    var dicInput = dicRow.querySelector('input[name="dic"]');
                    if (dicInput) {
                        dicInput.required = false;
                        dicInput.value = '';
                    }
                    console.log('‚ùå DIƒå pole skryto');
                }
            });
            
            // Pokud je checkbox u≈æ za≈°krtnut√Ω, zobraz DIƒå pole
            if (checkbox.checked) {
                dicRow.style.display = 'block';
                var dicInput = dicRow.querySelector('input[name="dic"]');
                if (dicInput) {
                    dicInput.required = true;
                }
            }
        } else {
            console.error('‚ùå Nena≈°el jsem pot≈ôebn√© elementy pro DIƒå toggle');
        }
    }, 100); // Poƒçkej 100ms po naƒçten√≠

    // ARES funkcionalita pro tenant formul√°≈ô
    setTimeout(function() {
        console.log('üåê Inicializace ARES lookup pro tenant formul√°≈ô');
        
        // ZABR√ÅNƒöN√ç DVOJ√çMU SPU≈†TƒöN√ç - zablokuj ares-lookup.js
        if (window.initAresLookup) {
            console.log('üö´ Blokuji ares-lookup.js pro tenant formul√°≈ô');
            window.initAresLookup = function() {
                console.log('üö´ ares-lookup.js zablokov√°n - tenant m√° vlastn√≠ implementaci');
            };
        }
        
        initTenantAresLookup();
    }, 150);
});

// ARES lookup specificky pro tenant formul√°≈ô
function initTenantAresLookup() {
    var aresButton = document.getElementById('load-from-ares');
    
    if (!aresButton) {
        console.log('ARES tlaƒç√≠tko nenalezeno');
        return;
    }
    
    // Zablokuj p≈Øvodn√≠ ares-lookup.js event listenery
    var newButton = aresButton.cloneNode(true);
    aresButton.parentNode.replaceChild(newButton, aresButton);
    aresButton = newButton;
    
    console.log('ARES tlaƒç√≠tko nalezeno a vyƒçi≈°tƒõno od konfliktn√≠ch listener≈Ø');
    
    aresButton.addEventListener('click', function(e) {
        e.preventDefault();
        e.stopPropagation();
        
        console.log('üñ±Ô∏è ARES tlaƒç√≠tko kliknuto (tenant verze)');
        
        // Najdi IƒåO pole v tenant formul√°≈ôi
        var icoInput = document.querySelector('input[name="ic"]') ||
                      document.getElementById('frm-createTenantForm-ic');
        
        if (!icoInput || icoInput.value.trim() === '') {
            showTenantMessage('Pros√≠m zadejte IƒåO', 'danger');
            if (icoInput) icoInput.focus();
            return;
        }
        
        var icoValue = icoInput.value.trim().replace(/\s/g, '');
        if (!/^\d{7,8}$/.test(icoValue)) {
            showTenantMessage('IƒåO mus√≠ obsahovat 7 nebo 8 ƒç√≠slic', 'danger');
            icoInput.focus();
            return;
        }
        
        // Zobraz loading indik√°tor s CSS fix pro spinner
        var originalText = aresButton.innerHTML;
        aresButton.disabled = true;
        aresButton.innerHTML = '<i class="bi bi-arrow-repeat spinner-rotate"></i> Naƒç√≠t√°m z ARESu...';
        
        console.log('üì° Odes√≠l√°m AJAX po≈æadavek pro IƒåO:', icoValue);
        
        // AJAX po≈æadavek
        var url = window.location.href.split('?')[0] + '?do=aresLookup&ico=' + encodeURIComponent(icoValue);
        
        fetch(url, {
            method: 'GET',
            headers: {
                'X-Requested-With': 'XMLHttpRequest',
                'Accept': 'application/json'
            }
        })
        .then(function(response) {
            console.log('üì• ARES odpovƒõƒè p≈ôijata, status:', response.status);
            return response.json();
        })
        .then(function(responseData) {
            console.log('üìã ARES data:', responseData);
            
            if (responseData.error) {
                showTenantMessage(responseData.error, 'danger');
                return;
            }
            
            var data = responseData.data;
            if (!data || !data.name) {
                showTenantMessage('Neoƒçek√°van√Ω form√°t odpovƒõdi z ARESu', 'danger');
                return;
            }
            
            console.log('‚úÖ Zaƒç√≠n√°m vypl≈àov√°n√≠ tenant formul√°≈ôe...');
            
            // Vypln√≠me formul√°≈ôov√° pole tenant formul√°≈ôe
            var filledFields = [];
            
            if (fillTenantField('company_name', data.name)) {
                filledFields.push('n√°zev spoleƒçnosti');
            }
            
            if (fillTenantField('address', data.address)) {
                filledFields.push('adresa');
            }
            
            if (fillTenantField('city', data.city)) {
                filledFields.push('mƒõsto');
            }
            
            if (fillTenantField('zip', data.zip)) {
                filledFields.push('PSƒå');
            }
            
            if (fillTenantField('country', data.country)) {
                filledFields.push('zemƒõ');
            }
            
            if (fillTenantField('dic', data.dic)) {
                filledFields.push('DIƒå');
                // Pokud m√° DIƒå, automaticky za≈°krtni "Pl√°tce DPH"
                var vatCheckbox = document.querySelector('input[name="vat_payer"]');
                if (vatCheckbox && data.dic) {
                    vatCheckbox.checked = true;
                    vatCheckbox.dispatchEvent(new Event('change'));
                }
            }
            
            if (filledFields.length > 0) {
                showTenantMessage('Data √∫spƒõ≈°nƒõ naƒçtena z ARESu: ' + filledFields.join(', '), 'success');
                console.log('‚úÖ Formul√°≈ô vyplnƒõn, pole:', filledFields);
            } else {
                showTenantMessage('Data z ARESu byla naƒçtena, ale nepoda≈ôilo se vyplnit ≈æ√°dn√© pole formul√°≈ôe', 'warning');
            }
        })
        .catch(function(error) {
            console.error('‚ùå Chyba p≈ôi naƒç√≠t√°n√≠ dat z ARES:', error);
            showTenantMessage('Nepoda≈ôilo se naƒç√≠st data z ARESu: ' + error.message, 'danger');
        })
        .finally(function() {
            // Obnov tlaƒç√≠tko a ZASTAV√ç SPINNER
            console.log('üîÑ Obnovuji tlaƒç√≠tko');
            aresButton.disabled = false;
            aresButton.innerHTML = originalText;
        });
    });
}

// Vypln√≠ pole tenant formul√°≈ôe
function fillTenantField(fieldName, value) {
    if (!value) return false;
    
    var field = document.querySelector('input[name="' + fieldName + '"], textarea[name="' + fieldName + '"], select[name="' + fieldName + '"]');
    
    if (field && value.toString().trim() !== '') {
        field.value = value.toString().trim();
        field.dispatchEvent(new Event('input', { bubbles: true }));
        field.dispatchEvent(new Event('change', { bubbles: true }));
        console.log('üìù Vyplnƒõno pole', fieldName + ':', value);
        return true;
    }
    
    return false;
}

// Zobraz√≠ zpr√°vu v tenant formul√°≈ôi - POUZE JEDNU
function showTenantMessage(message, type) {
    // Odstra≈à V≈†ECHNY star√© zpr√°vy (i z ares-lookup.js)
    var existingMessages = document.querySelectorAll('[id^="tenant-ares-message"], [id^="ares-message"], .alert');
    existingMessages.forEach(function(msg) { 
        if (msg.textContent && (msg.textContent.includes('ARESu') || msg.textContent.includes('naƒçten'))) {
            msg.remove(); 
        }
    });
    
    var messageElement = document.createElement('div');
    messageElement.id = 'tenant-ares-message-' + Date.now();
    messageElement.className = 'alert alert-' + type + ' mt-3';
    
    var icon;
    switch (type) {
        case 'success': icon = 'check-circle-fill'; break;
        case 'warning': icon = 'exclamation-triangle-fill'; break;
        case 'danger': icon = 'x-circle-fill'; break;
        default: icon = 'info-circle-fill';
    }
    
    messageElement.innerHTML = '<i class="bi bi-' + icon + ' me-2"></i>' + message;
    
    // Vlo≈æ zpr√°vu za ARES tlaƒç√≠tko
    var aresButton = document.getElementById('load-from-ares');
    if (aresButton) {
        var container = aresButton.closest('.input-group') || aresButton.closest('.mb-3') || aresButton.parentNode;
        if (container) {
            container.appendChild(messageElement);
        }
    }
    
    console.log('üí¨ Zobrazena zpr√°va:', message);
    
    // Automatick√© zmizen√≠ po 8 sekund√°ch
    if (type === 'success' || type === 'warning') {
        setTimeout(function() {
            if (messageElement.parentNode) {
                messageElement.style.transition = 'opacity 0.5s ease';
                messageElement.style.opacity = '0';
                setTimeout(function() {
                    if (messageElement.parentNode) {
                        messageElement.remove();
                    }
                }, 500);
            }
        }, 8000);
    }
}
</script>

<style>
/* CSS fix pro spinner animaci */
.spinner-rotate {
    animation: spin 1s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
</style>
{/syntax}

{/block}