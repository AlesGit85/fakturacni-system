{* Migration Utility - Hlavn√≠ str√°nka n√°stroj≈Ø - Konzistentn√≠ design *}
{block title}Migration Utility{/block}

{block content}

{* Hlaviƒçka str√°nky - stejn√Ω styl jako Security str√°nky *}
<div class="security-page-header">
    <div class="d-flex justify-content-between align-items-center">
        <div>
            <h1>üîÑ Migration Utility</h1>
            <p>N√°stroje pro migraci a aktualizaci dat v syst√©mu</p>
        </div>
        <div class="security-header-actions">
            <button id="testConnectionBtn" class="btn btn-outline-secondary" data-url="{link testConnection!}">
                <i class="bi bi-wifi me-2"></i>Test p≈ôipojen√≠
            </button>
        </div>
    </div>
</div>

{* √övodn√≠ informace - stejn√Ω styl jako Security *}
<div class="security-audit-intro">
    <div class="row">
        <div class="col-md-8 mx-auto">
            <div class="card security-intro-card">
                <div class="card-body">
                    <div class="security-intro-icon">
                        <i class="bi bi-arrow-repeat"></i>
                    </div>
                    <h3 class="security-intro-title">Migration Tools</h3>
                    <p class="security-intro-description">
                        N√°stroje pro bezpeƒçnou migraci a aktualizaci dat v datab√°zi.
                        V≈°echny operace jsou logov√°ny a lze je sledovat v re√°ln√©m ƒçase.
                    </p>
                    
                    <div class="row security-intro-features">
                        <div class="col-md-6">
                            <div class="security-feature-section">
                                <h6 class="security-feature-title">
                                    <i class="bi bi-check-circle me-2"></i>Dostupn√© n√°stroje:
                                </h6>
                                <ul class="security-feature-list">
                                    <li>≈†ifrov√°n√≠ star√Ωch neza≈°ifrovan√Ωch dat</li>
                                    <li>Migrace klient≈Ø a firemn√≠ch √∫daj≈Ø</li>
                                    <li>Anal√Ωza dat p≈ôed migrac√≠</li>
                                    <li>Batch processing s progress tracking</li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="security-feature-section">
                                <h6 class="security-feature-title">
                                    <i class="bi bi-shield-check me-2"></i>Bezpeƒçnostn√≠ vlastnosti:
                                </h6>
                                <ul class="security-feature-list">
                                    <li>AES-256-GCM ≈°ifrov√°n√≠</li>
                                    <li>Atomick√© datab√°zov√© transakce</li>
                                    <li>Kompletn√≠ auditov√°n√≠ zmƒõn</li>
                                    <li>Rollback mo≈ænosti</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    
                    <div class="security-intro-warning">
                        <i class="bi bi-exclamation-triangle me-2"></i>
                        <strong>Upozornƒõn√≠:</strong> P≈ôed spu≈°tƒõn√≠m jak√©koliv migrace doporuƒçujeme vytvo≈ôit z√°lohu datab√°ze.
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{* Syst√©mov√© statistiky - podobn√© jako Security Dashboard *}
<div class="row mb-4">
    <div class="col-md-3 col-sm-6 mb-3">
        <div class="card security-stat-card">
            <div class="card-body">
                <div class="security-stat-icon">
                    <i class="bi bi-database-check"></i>
                </div>
                <div class="security-stat-label" id="dbStatus" style="color: #B1D235;">OK</div>
                <div class="security-stat-label">Datab√°zov√© p≈ôipojen√≠</div>
                <div class="security-stat-subtitle">Stav syst√©mu</div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 col-sm-6 mb-3">
        <div class="card security-stat-card">
            <div class="card-body">
                <div class="security-stat-icon">
                    <i class="bi bi-lock-fill"></i>
                </div>
                <div class="security-stat-label" style="color: #B1D235;">Aktivn√≠</div>
                <div class="security-stat-label">≈†ifrovac√≠ slu≈æba</div>
                <div class="security-stat-subtitle">EncryptionService</div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 col-sm-6 mb-3">
        <div class="card security-stat-card">
            <div class="card-body">
                <div class="security-stat-icon">
                    <i class="bi bi-person-check"></i>
                </div>
                <div class="security-stat-label" style="color: #B1D235;">
                    {if $isSuperAdmin}Super Admin{else}Admin{/if}
                </div>
                <div class="security-stat-label">Opr√°vnƒõn√≠</div>
                <div class="security-stat-subtitle">Aktu√°ln√≠ role</div>
            </div>
        </div>
    </div>
    
    <div class="col-md-3 col-sm-6 mb-3">
        <div class="card security-stat-card">
            <div class="card-body">
                <div class="security-stat-icon">
                    <i class="bi bi-clock-history"></i>
                </div>
                <div class="security-stat-label" style="color: #B1D235;">P≈ôipraveno</div>
                <div class="security-stat-label">Migration Status</div>
                <div class="security-stat-subtitle">N√°stroje k dispozici</div>
            </div>
        </div>
    </div>
</div>

{* Dostupn√© n√°stroje - stejn√Ω styl jako Security Tools *}
<div class="security-tools-section">
    <h2 class="security-tools-title">Dostupn√© migraƒçn√≠ n√°stroje</h2>
    
    <div class="row">
        <div class="col-lg-6 mb-4">
            <div class="card security-tool-card">
                <div class="card-header security-tool-header text-center">
                    <div>
                        <i class="bi bi-lock-fill security-tool-icon mb-2 d-block" style="font-size: 2.5rem;"></i>
                        <h5 class="security-tool-title mb-1">≈†ifrov√°n√≠ star√Ωch dat</h5>
                        <small class="security-tool-subtitle">Data Encryption Migration</small>
                    </div>
                </div>
                <div class="card-body security-tool-body">
                    <p class="security-tool-description">
                        Za≈°ifruje v≈°echna star√° neza≈°ifrovan√° data v datab√°zi pomoc√≠ AES-256-GCM ≈°ifrov√°n√≠.
                        Podporuje klienty, firemn√≠ √∫daje a dal≈°√≠ citliv√° data.
                    </p>
                    
                    <div class="security-tool-features">
                        <div class="security-feature-item">
                            <i class="bi bi-check-circle text-success me-2"></i>
                            <span>Batch processing s progress barem</span>
                        </div>
                        <div class="security-feature-item">
                            <i class="bi bi-check-circle text-success me-2"></i>
                            <span>Atomick√© datab√°zov√© transakce</span>
                        </div>
                        <div class="security-feature-item">
                            <i class="bi bi-check-circle text-success me-2"></i>
                            <span>Kompletn√≠ auditov√°n√≠ zmƒõn</span>
                        </div>
                    </div>
                    
                    <div class="security-tool-actions text-center mt-4">
                        <a href="{link encryptOldData}" class="btn security-tool-btn btn-primary">
                            <i class="bi bi-play-circle me-2"></i>Spustit ≈°ifrov√°n√≠
                        </a>
                        <small class="security-tool-note d-block mt-2" style="color: #9fa5aa;">
                            <i class="bi bi-info-circle me-1"></i>
                            Doporuƒçujeme spustit v dobƒõ mimo provoz
                        </small>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-6 mb-4">
            <div class="card security-tool-card security-tool-card-placeholder">
                <div class="card-header security-tool-header text-center">
                    <div>
                        <i class="bi bi-plus-circle security-tool-icon mb-2 d-block text-muted" style="font-size: 2.5rem;"></i>
                        <h5 class="security-tool-title mb-1 text-muted">Dal≈°√≠ n√°stroje</h5>
                        <small class="security-tool-subtitle text-muted">P≈ôipravuje se</small>
                    </div>
                </div>
                <div class="card-body security-tool-body">
                    <p class="security-tool-description text-muted">
                        Zde budou postupnƒõ p≈ôib√Ωvat dal≈°√≠ migraƒçn√≠ n√°stroje pro √∫dr≈æbu a aktualizaci syst√©mu.
                        Napl√°novan√©: migrace u≈æivatelsk√Ωch dat, optimalizace datab√°ze, konverze form√°t≈Ø.
                    </p>
                    
                    <div class="security-tool-features">
                        <div class="security-feature-item text-muted">
                            <i class="bi bi-clock me-2"></i>
                            <span>Migrace u≈æivatelsk√Ωch rol√≠</span>
                        </div>
                        <div class="security-feature-item text-muted">
                            <i class="bi bi-clock me-2"></i>
                            <span>Optimalizace datab√°zov√Ωch index≈Ø</span>
                        </div>
                        <div class="security-feature-item text-muted">
                            <i class="bi bi-clock me-2"></i>
                            <span>Konverze star√Ωch form√°t≈Ø</span>
                        </div>
                    </div>
                    
                    <div class="security-tool-actions text-center">
                        <button class="btn btn-outline-secondary" disabled>
                            <i class="bi bi-clock me-2"></i>V p≈ô√≠pravƒõ
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{* Toast kontejner pro notifikace *}
<div class="toast-container position-fixed bottom-0 end-0 p-3">
    <div id="migrationToast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <i class="bi bi-info-circle-fill text-primary me-2"></i>
            <strong class="me-auto">Migration Utility</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body">
            <!-- Obsah bude vlo≈æen JavaScriptem -->
        </div>
    </div>
</div>

{* JavaScript pro z√°kladn√≠ funkƒçnost *}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Test p≈ôipojen√≠ k datab√°zi
    const testConnectionBtn = document.getElementById('testConnectionBtn');
    if (testConnectionBtn) {
        testConnectionBtn.addEventListener('click', function() {
            const url = this.dataset.url;
            
            // Zmƒõna stavu tlaƒç√≠tka
            this.disabled = true;
            this.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Testuje se...';
            
            fetch(url, {
                method: 'POST',
                headers: {
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => response.json())
            .then(data => {
                // Zobrazen√≠ v√Ωsledku
                showToast(data.success ? 'success' : 'error', data.message);
                
                // Aktualizace status indik√°toru
                const dbStatus = document.getElementById('dbStatus');
                if (data.success) {
                    dbStatus.textContent = 'OK';
                    dbStatus.parentElement.querySelector('.security-stat-icon i').className = 'bi bi-database-check';
                } else {
                    dbStatus.textContent = 'Chyba';
                    dbStatus.parentElement.querySelector('.security-stat-icon i').className = 'bi bi-database-x';
                }
            })
            .catch(error => {
                showToast('error', 'Chyba p≈ôi testov√°n√≠ p≈ôipojen√≠');
                console.error('Error:', error);
            })
            .finally(() => {
                // Obnoven√≠ tlaƒç√≠tka
                this.disabled = false;
                this.innerHTML = '<i class="bi bi-wifi me-2"></i>Test p≈ôipojen√≠';
            });
        });
    }
    
    // Funkce pro zobrazen√≠ toast notifikace
    function showToast(type, message) {
        const toast = document.getElementById('migrationToast');
        const toastBody = toast.querySelector('.toast-body');
        const toastHeader = toast.querySelector('.toast-header i');
        
        // Nastaven√≠ typu a zpr√°vy
        toastBody.textContent = message;
        
        // Zmƒõna ikony podle typu
        if (type === 'success') {
            toastHeader.className = 'bi bi-check-circle-fill text-success me-2';
        } else if (type === 'error') {
            toastHeader.className = 'bi bi-exclamation-circle-fill text-danger me-2';
        } else {
            toastHeader.className = 'bi bi-info-circle-fill text-primary me-2';
        }
        
        // Zobrazen√≠ toast
        const bsToast = new bootstrap.Toast(toast);
        bsToast.show();
    }
});
</script>

{/block}